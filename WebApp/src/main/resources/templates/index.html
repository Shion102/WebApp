<!doctype html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>アニメ管理</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
<div class="container my-1">
    <div class="card mt-4">
        <div class="card-body">

            <div class="card mb-4">
                <div class="card-header">
                    検索
                </div>
                <div class="card-body">
                    <!-- <h5 class="card-title">Test</h5> -->
                    <p>作品名<input type="text" class="ms-3 me-3"></p>
                    <p>
                        年度
                        <select class="ms-3 me-3" id="year"></select>
                    </p>
                    <p>
                        時期
                        <select class="ms-3 me-3">
                            <option selected>指定しない</option>
                            <option value="1">春(4月~6月)</option>
                            <option value="2">夏(7月~9月)</option>
                            <option value="3">秋(10月~12月)</option>
                            <option value="3">冬(1月~3月)</option>
                        </select>
                    </p>
                    <button type="button" class="btn btn-primary" id="searchBtn">検索</button>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header">
                    検索結果
                </div>
                <div class="card-body" id="animeList">

                </div>
            </div>
        </div>
    </div>
</div>

<script>
    'use strict';
    var year = new Date().getFullYear();
    var selectDom = document.getElementById('year');
    var optionDom = '<option value="" selected>指定しない</option>';;
    for (var i = year; i >= 1970; i--) {
      var option = '';
        option = '<option value="' + i + '">' + i + '</option>';
      optionDom += option;
    }
    selectDom.insertAdjacentHTML('beforeend', optionDom);

    function addAnimeList(data){
      const container = document.getElementById('animeList');
      for(let i = 0; i < data.length; i++){
        container.insertAdjacentHTML(
          'afterbegin',
          `
          <div class="card m-2">
            <label class="form-check-label" for="radio` +  data.animeList[i].id + `">
            <div class="card-body">
              <div class="form-check">
                <div class="d-sm-flex">
                  <div class="d-block align-content-center ms-1">
                    <input class="form-check-input fs-5" type="radio" name="radioGroup" id="radio` + data.animeList[i].id + `">
                  </div>
                  <div class="text-center ratio ratio-16x9 w-25 ms-1">
                    <img class="rounded img-thumbnail" style="object-fit: contain;" src="` + data.animeList[i].ogImageUrl + `">
                  </div>
                  <div class="d-block ms-3 align-content-center">
                    <h5>` + data.animeList[i].title + `</h5>
                    <p class="mt-3">
                      <span class="badge text-bg-primary fs-6">` + data.animeList[i].season + `</span>
                      <span class="badge text-bg-success fs-6">` + data.animeList[i].media + `</span>
                      <a class="link-opacity-100" href="` + data.animeList[i].officialSite + `">
                        公式サイト
                      </a>
                    </p>
                  </div>
                </div>
              </div>
            </div>
            </label>
          </div>
        `);
      }
      console.log(1111);
    }

    const container = document.getElementById('animeList');
    let totalCount =160;
    let currentPage = 1;
    let allPage = Math.ceil(totalCount / 50);
    container.insertAdjacentHTML(
      'beforeend',
      `
      <div class="d-flex justify-content-around mt-3">
        <button type="button" class="btn btn-primary">前のページ</button>
        <span class="align-content-center">` + currentPage + `&nbsp;/&nbsp;` + allPage + `</span>
        <button type="button" class="btn btn-primary">次のページ</button>
      </div>
      `
    );

  document.getElementById('searchBtn').addEventListener('click', () => {
    // 入力された郵便番号を取得
    //const postalCode = document.getElementById('postal-code').value
    // HTTPリクエストの送信
    fetch(`/api/anime?title=ハイキュー&year=&season=&page=1`)
      .then(res => {
        // ステータスコードによって処理を分ける
        if(res.status === 400) {
        } else {
          res.json()
          .then(data => {
            console.log(data.animeList[0]);
            console.log(data.nextPage);
            console.log(data.prevPage);
            console.log(data.totalCount);
            console.log(data);

            addAnimeList(data);
          })
        }
    });
  });

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
</body>
</html>